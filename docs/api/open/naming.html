<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>NamingService &bull; Fusion DiscoveryX</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="discoveryx-docs"/>
<link rel="canonical" href="https://akka-fusion.github.io/fusion-discoveryx/api/open/naming.html"/>
<script type="text/javascript" src="../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../../css/page-6.css"/>
<link rel="stylesheet" type="text/css" href="../../css/banner.css"/>
<link rel="shortcut icon" href="../../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16.png"/>
<link rel="manifest" href="../../images/manifest.json"/>
<meta name="msapplication-TileImage" content="../../images/mstile-150x150.png"/>
<meta name="msapplication-TileColor" content="#15a9ce"/>
<meta name="theme-color" content="#15a9ce"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>


<body id="underlay" data-toggler="nav-open">
<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="https://akka.io"><img class="logo" src="../../images/akka-logo-reverse.svg"/></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../../index.html">Fusion DiscoveryX</a></h1>
</div>
<div class="nav-header-version">
Version 0.1.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../../intro.html" class="page">介绍</a></li>
  <li><a href="../../use/index.html" class="page">使用</a></li>
  <li><a href="../../design/index.html" class="page">设计</a></li>
  <li><a href="../../api/index.html" class="page">API</a>
  <ul>
    <li><a href="../../api/index.html#目录" class="header">目录</a></li>
    <li><a href="../../api/open/index.html" class="page">开放API</a>
    <ul>
      <li><a href="../../api/open/config.html" class="page">ConfigService</a></li>
      <li><a href="../../api/open/naming.html#namingservice" class="active page">NamingService</a>
      <ul>
        <li><a href="../../api/open/naming.html#registerinstance" class="header">RegisterInstance</a></li>
        <li><a href="../../api/open/naming.html#removeinstance" class="header">RemoveInstance</a></li>
        <li><a href="../../api/open/naming.html#queryinstance" class="header">QueryInstance</a></li>
        <li><a href="../../api/open/naming.html#modifyinstance" class="header">ModifyInstance</a></li>
        <li><a href="../../api/open/naming.html#heartbeat" class="header">Heartbeat</a></li>
      </ul></li>
      <li><a href="../../api/open/grpc.html" class="page">gRPC Service Descriptor</a></li>
    </ul></li>
    <li><a href="../../api/management/index.html" class="page">管理API</a></li>
    <li><a href="../../api/json.html" class="page">JSON 说明</a></li>
  </ul></li>
  <li><a href="../../deploy/index.html" class="page">部署</a></li>
  <li><a href="../../releases.html" class="page">发布</a></li>
</ul>
</nav>
</div>
</header>
<div class="site-content-wrapper">
<aside class="sticky-sidebar show-for-large">
<header class="nav-header sticky-sidebar-header">
<div class="nav-header-title">
<h1><a href="../../index.html">Fusion DiscoveryX</a></h1>
</div>
<div class="nav-header-version">
Version 0.1.0
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
</header>
<nav class="site-nav sticky-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../../intro.html" class="page">介绍</a></li>
  <li><a href="../../use/index.html" class="page">使用</a></li>
  <li><a href="../../design/index.html" class="page">设计</a></li>
  <li><a href="../../api/index.html" class="page">API</a>
  <ul>
    <li><a href="../../api/index.html#目录" class="header">目录</a></li>
    <li><a href="../../api/open/index.html" class="page">开放API</a>
    <ul>
      <li><a href="../../api/open/config.html" class="page">ConfigService</a></li>
      <li><a href="../../api/open/naming.html#namingservice" class="active page">NamingService</a>
      <ul>
        <li><a href="../../api/open/naming.html#registerinstance" class="header">RegisterInstance</a></li>
        <li><a href="../../api/open/naming.html#removeinstance" class="header">RemoveInstance</a></li>
        <li><a href="../../api/open/naming.html#queryinstance" class="header">QueryInstance</a></li>
        <li><a href="../../api/open/naming.html#modifyinstance" class="header">ModifyInstance</a></li>
        <li><a href="../../api/open/naming.html#heartbeat" class="header">Heartbeat</a></li>
      </ul></li>
      <li><a href="../../api/open/grpc.html" class="page">gRPC Service Descriptor</a></li>
    </ul></li>
    <li><a href="../../api/management/index.html" class="page">管理API</a></li>
    <li><a href="../../api/json.html" class="page">JSON 说明</a></li>
  </ul></li>
  <li><a href="../../deploy/index.html" class="page">部署</a></li>
  <li><a href="../../releases.html" class="page">发布</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer sticky-sidebar-footer">
<a href="https://akka.io"><img class="logo" src="../../images/akka-logo-reverse.svg"/></a>

</footer>
</aside>
<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">
<article class="page-content row">
<div class="small-12 column" id="docs">
<h1><a href="#namingservice" name="namingservice" class="anchor"><span class="anchor-link"></span></a>NamingService</h1>
<ul>
  <li>gRPC服务地址：<code>/fusion.discoveryx.grpc.NamingService</code></li>
  <li>REST URL前缀：<code>/fusion/discoveryx/v1/naming</code></li>
</ul>
<p>REST URL路径由 <strong>REST URL前缀</strong> + 服务名组织，均使用 <strong>POST</strong> 方法的请求，JSON序例化格式。如查询实例接口访问地址为：<code>POST /fusion/discoveryx/v1/naming/QueryInstance</code>。Protobuf与JSON格式转换请参阅： <a href="../json.html">JSON 说明</a>。</p>
<h3><a href="#registerinstance" name="registerinstance" class="anchor"><span class="anchor-link"></span></a>RegisterInstance</h3>
<p><strong>gRPC</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/grpc/discoveryx.proto#L49-L51" target="_blank" title="Go to snippet source"></a><code class="language-proto">// 注册实例
rpc RegisterInstance (fusion.discoveryx.model.InstanceRegister) returns (fusion.discoveryx.model.NamingReply) {
}</code></pre>
<p><strong>请求</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L192-L225" target="_blank" title="Go to snippet source"></a><code class="language-proto">message InstanceRegister {
    // Instance namespace.
    string namespace = 1;
    // Instance serviceName.
    string service_name = 2;
    // The instance group name needs to be the same as service group name, otherwise the service group name will be overwritten.
    string group_name = 3;
    // Instance local ip.
    string ip = 4;
    // Instance local port.
    int32 port = 5;
    // Instance query weight, the default value is 1.0.
    double weight = 6;
    // instance health status. If set to true, it will be available immediately. Otherwise, it will be available after the first heartbeat detection is successful. The default value is false.
    bool health = 7;
    // If instance is enabled to accept request, the default value is false.
    bool enable = 8;
    // If instance is ephemeral, the default value is false.
    bool ephemeral = 9;
    // user extended attributes
    map&lt;string, string&gt; metadata = 10;
    // Healthy check method, the default value is HealthyCheckMethod.CLIENT_REPORT
    HealthyCheckMethod healthy_check_method = 11;
    // Healthy check per N seconds
    int32 healthy_check_interval = 12;
    // Unhealthy check count
    int32 unhealthy_check_count = 13;
    // Healthy check protocol
    HealthyCheckProtocol protocol = 14;
    // Whether TLS(HTTPS) is used for gRPC connection, the default value is false.
    bool use_tls = 15;
    // HTTP healthy check uri path.
    string http_path = 16;
}</code></pre>
<p><strong>响应</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L316-L323" target="_blank" title="Go to snippet source"></a><code class="language-proto">message NamingReply {
    int32 status = 1;
    string message = 2;
    oneof data {
        Instance instance = 3;
        ServiceInfo service_info = 4;
    }
}</code></pre>
<h4><a href="#instance" name="instance" class="anchor"><span class="anchor-link"></span></a>Instance</h4>
<p><code>oneof</code>的<code>instance</code>字段将返回已注册实例信息，如下：</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L144-L188" target="_blank" title="Go to snippet source"></a><code class="language-proto"><br/>// 健康检查方式
enum HealthyCheckMethod {
    NOT_SET = 0;
    CLIENT_REPORT = 1;
    SERVER_SNIFF = 2;
}

enum HealthyCheckProtocol {
    UNKNOWN = 0;
    UDP = 1;
    TCP = 2;
    HTTP = 3;
}

message Instance {
    // unique id of this instance.
    string instance_id = 1;
    // instance ip
    string ip = 2;
    // instance port
    int32 port = 3;
    // instance weight
    double weight = 4;
    // instance health status
    bool healthy = 5;
    // If instance is enabled to accept request
    bool enabled = 6;
    // If instance is ephemeral
    bool ephemeral = 7;
    // user extended attributes
    map&lt;string, string&gt; metadata = 8;
    // Healthy check method, the default value is HealthyCheckMethod.CLIENT_REPORT
    HealthyCheckMethod healthy_check_method = 9;
    // Healthy check per N seconds
    int32 healthy_check_interval = 10;
    // Unhealthy check count
    int32 unhealthy_check_count = 11;
    // Healthy check protocol
    HealthyCheckProtocol protocol = 12;
    // Whether TLS(HTTPS) is used for gRPC connection, the default value is false.
    bool use_tls = 13;
    // HTTP healthy check uri path.
    string http_path = 14;
}</code></pre>
<h3><a href="#removeinstance" name="removeinstance" class="anchor"><span class="anchor-link"></span></a>RemoveInstance</h3>
<p><strong>gRPC</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/grpc/discoveryx.proto#L61-L63" target="_blank" title="Go to snippet source"></a><code class="language-proto">// 删除实例
rpc RemoveInstance (fusion.discoveryx.model.InstanceRemove) returns (fusion.discoveryx.model.NamingReply) {
}</code></pre>
<p><strong>请求</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L259-L263" target="_blank" title="Go to snippet source"></a><code class="language-proto">message InstanceRemove {
    string namespace = 1;
    string service_name = 2;
    string instance_id = 3;
}</code></pre>
<p><strong>响应</strong></p>
<p>删除实例没有<code>oneof</code>字段返回。</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L316-L323" target="_blank" title="Go to snippet source"></a><code class="language-proto">message NamingReply {
    int32 status = 1;
    string message = 2;
    oneof data {
        Instance instance = 3;
        ServiceInfo service_info = 4;
    }
}</code></pre>
<h3><a href="#queryinstance" name="queryinstance" class="anchor"><span class="anchor-link"></span></a>QueryInstance</h3>
<p><strong>gRPC</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/grpc/discoveryx.proto#L43-L45" target="_blank" title="Go to snippet source"></a><code class="language-proto">// 查询实例
rpc QueryInstance (fusion.discoveryx.model.InstanceQuery) returns (fusion.discoveryx.model.NamingReply) {
}</code></pre>
<p><strong>请求</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L267-L275" target="_blank" title="Go to snippet source"></a><code class="language-proto">message InstanceQuery {
    string namespace = 1;
    string service_name = 2;
    string group_name = 3;
    // only return all healthy instances
    bool all_healthy = 4;
    // only return one healthy instance
    bool one_healthy = 5;
}</code></pre>
<p><strong>响应</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L316-L323" target="_blank" title="Go to snippet source"></a><code class="language-proto">message NamingReply {
    int32 status = 1;
    string message = 2;
    oneof data {
        Instance instance = 3;
        ServiceInfo service_info = 4;
    }
}</code></pre>
<p>查询成功<code>oneof</code>通过<code>queried</code>字段将查询匹配到的实例返回：</p>
<h3><a href="#modifyinstance" name="modifyinstance" class="anchor"><span class="anchor-link"></span></a>ModifyInstance</h3>
<p><strong>gRPC</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/grpc/discoveryx.proto#L55-L57" target="_blank" title="Go to snippet source"></a><code class="language-proto">// 修改实例
rpc ModifyInstance (fusion.discoveryx.model.InstanceModify) returns (fusion.discoveryx.model.NamingReply) {
}</code></pre>
<p><strong>请求</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L229-L255" target="_blank" title="Go to snippet source"></a><code class="language-proto">message InstanceModify {
    string namespace = 1;
    string service_name = 2;
    string instance_id = 3;
    google.protobuf.StringValue group_name = 4;
    google.protobuf.StringValue ip = 5;
    google.protobuf.Int32Value port = 6;
    // instance weight
    google.protobuf.DoubleValue weight = 7;
    // instance health status
    google.protobuf.BoolValue health = 8;
    // If instance is enabled to accept request
    google.protobuf.BoolValue enable = 9;
    // user extended attributes
    map&lt;string, string&gt; metadata = 10;
    // true：replace old metadata, false: merge old metadata
    bool replace_metadata = 11;
    HealthyCheckMethod healthy_check_method = 12;
    // Healthy check per N seconds
    google.protobuf.Int32Value healthy_check_interval = 13;
    // Unhealthy check count
    google.protobuf.Int32Value unhealthy_check_count = 14;
    // 实例协议
    HealthyCheckProtocol protocol = 15;
    google.protobuf.BoolValue use_tls = 16;
    google.protobuf.StringValue http_path = 17;
}</code></pre>
<p><strong>响应</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/model/discoveryx.proto#L316-L323" target="_blank" title="Go to snippet source"></a><code class="language-proto">message NamingReply {
    int32 status = 1;
    string message = 2;
    oneof data {
        Instance instance = 3;
        ServiceInfo service_info = 4;
    }
}</code></pre>
<p><code>oneof</code>的<code>instance</code>字段将返回修改后的实例信息。</p>
<h3><a href="#heartbeat" name="heartbeat" class="anchor"><span class="anchor-link"></span></a>Heartbeat</h3>
<p><strong>gRPC</strong></p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-common/src/main/protobuf/fusion/discoveryx/grpc/discoveryx.proto#L72-L79" target="_blank" title="Go to snippet source"></a><code class="language-proto">// 实例心跳消息。namespace, serviceName, ip, port, instanceId等使用metadata（HTTP Header发送）
//- `x-discoveryx-namespace`：命名空间
//- `x-discoveryx-service-name`：服务名
//- `x-discoveryx-ip`：服务监听IP地址
//- `x-discoveryx-port`：服务监听网络端口
//- `x-discoveryx-instance-id`：实例ID
rpc Heartbeat (stream fusion.discoveryx.model.InstanceHeartbeat) returns (stream fusion.discoveryx.model.ServerStatusBO) {
}</code></pre>
<p><code>Heartbeat</code>接口第一次调用时需要通过<code>metadata</code>（HTTP Header）传递以下内容：</p>
<ul>
  <li><code>x-discoveryx-namespace</code>：命名空间</li>
  <li><code>x-discoveryx-service-name</code>：服务名</li>
  <li><code>x-discoveryx-ip</code>：服务监听IP地址</li>
  <li><code>x-discoveryx-port</code>：服务监听网络端口</li>
  <li><code>x-discoveryx-instance-id</code>：实例ID</li>
</ul>
</div>
</article>
<div class="row">
<div class="small-12 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../../api/open/config.html"><i class="icon-prev"></i> <span class="link-prev">ConfigService</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../../api/open/grpc.html">gRPC Service Descriptor <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>
<div class="source-github row">
在此文档中发现错误？该页面的源代码可以在 <a href="https://github.com/yangbajing/fusion-discoveryx/tree/master/discoveryx-docs/src/main/paradox/api/open/naming.md" target="_blank">这里</a> 找到。欢迎随时编辑并提交Pull Request。
</div>

<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../../images/akka-icon.svg" />
<section class="copyright">
<div>discoveryx-docs is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2019-2020 <a href="https://akka-fusion.github.com/" target="_blank">Akka Fusion</a> |
<a href="https://akka-fusion.github.io/fusion-discoveryx/" target="_blank">Fusion DiscoveryX</a> |
<a href="https://akka-fusion.github.io/fusion-schedulerx/" target="_blank">Fusion SchedulerX</a>
</p>
</section>


</footer>
</section>
</main>
</div>

<script type="text/javascript" src="../../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../js/groups.js"></script>
<script type="text/javascript" src="../../js/page.js"></script>
<script type="text/javascript" src="../../js/magellan.js"></script>
<script type="text/javascript" src="../../js/metadata-toggle.js"></script>

<style type="text/css">@import "../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">//<![CDATA[
jQuery(function(){window.prettyPrint && prettyPrint()});
//]]></script>
<!-- hook for including project specific javascript into the generated docs -->

</body>
</html>
